; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:seeed_xiao_esp32c3]
platform = espressif32
board = seeed_xiao_esp32c3
framework = arduino
monitor_speed = 115200
lib_deps = 
    https://github.com/BoschSensortec/BME68x-Sensor-API.git
    wire
    boschsensortec/BME68x Sensor library@^1.3.40408
; CPU Frequenz für minimalen Stromverbrauch
board_build.f_cpu = 80000000L             ; 80MHz statt 160MHz (50% weniger CPU-Stromverbrauch)
board_build.f_flash = 40000000L           ; 40MHz Flash (Standard, energieeffizient)

; Flash-Modus für beste Performance bei niedrigem Stromverbrauch
board_build.flash_mode = dio              ; DIO-Modus (weniger Pins = weniger Stromverbrauch)

; Partition Schema für minimale Größe
board_build.partitions = min_spiffs.csv   ; Minimales Partition-Schema

build_flags = 
    ; ========== COMPILER OPTIMIERUNGEN ==========
    -Os                                   ; Optimierung für Größe (besser als -O3 für Energie)
    -ffunction-sections                   ; Separate Funktions-Sektionen (Dead Code Elimination)
    -fdata-sections                       ; Separate Daten-Sektionen
    -Wl,--gc-sections                     ; Garbage Collection für nicht genutzte Sektionen
    -fno-exceptions                       ; Keine C++ Exceptions (spart Flash & RAM)
    -fno-rtti                            ; Keine Runtime Type Information
    
    ; ========== ESP32-C3 SPEZIFISCHE OPTIMIERUNGEN ==========
    -DCONFIG_ESP32C3_DEFAULT_CPU_FREQ_MHZ=80  ; CPU auf 80MHz begrenzen
    -DCONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=4  ; Weniger WiFi RX Buffer
    -DCONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=8  ; Weniger WiFi Dynamic Buffer
    -DCONFIG_ESP32_WIFI_STATIC_TX_BUFFER_NUM=4   ; Weniger WiFi TX Buffer
    
    ; ========== DEAKTIVIERUNG NICHT BENÖTIGTER FEATURES ==========
    -DCONFIG_BT_ENABLED=0                ; Bluetooth komplett deaktivieren
    -DCONFIG_BLUEDROID_ENABLED=0         ; Bluedroid Stack deaktivieren  
    -DCONFIG_BT_NIMBLE_ENABLED=0         ; NimBLE Stack deaktivieren
    -DCONFIG_ESP_COREDUMP_ENABLE=0       ; Core Dump deaktivieren
    -DCONFIG_ESP_TASK_WDT=0              ; Task Watchdog deaktivieren
    -DCONFIG_ESP_INT_WDT=0               ; Interrupt Watchdog deaktivieren
    
    ; ========== POWER MANAGEMENT OPTIMIERUNGEN ==========
    -DCONFIG_PM_ENABLE=1                 ; Power Management aktivieren
    -DCONFIG_ESP_DEFAULT_CPU_FREQ_MHZ=80  ; Standard CPU Frequenz
    
    ; ========== LOGGING OPTIMIERUNGEN ==========
    -DCONFIG_LOG_DEFAULT_LEVEL=0         ; Logging komplett deaktivieren (außer im Debug)
    -DCORE_DEBUG_LEVEL=0                 ; Arduino Core Debug deaktivieren
    
    ; ========== MEMORY OPTIMIERUNGEN ==========
    -DCONFIG_ESP32_WIFI_CACHE_TX_BUFFER_NUM=8  ; Weniger TX Cache Buffer
    -DCONFIG_LWIP_MAX_SOCKETS=4          ; Weniger Socket Buffer
    -DCONFIG_TCPIP_RECVMBOX_SIZE=8       ; Kleinere TCP/IP Mailboxen
